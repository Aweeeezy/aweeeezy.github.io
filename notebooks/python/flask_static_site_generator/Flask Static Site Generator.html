
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Creating-a-Static-Site-Generator-with-Flask">Creating a Static Site Generator with Flask<a class="anchor-link" href="#Creating-a-Static-Site-Generator-with-Flask">&#182;</a></h1><p>A static site is one that has no interactive capabilities; it is simply a collection of one or more HTML documents that are linked together. While limited in functionality, a static site may be all that is necessary. This blog, itself, is a static site and it was created by the very process I am about to outline.</p>
<p>I decided just a couple of weeks before making this post that I wanted to create a blog that would serve as a creative outlet for me while also showcasing my knowledge and abilities. Upon an initial search for ideas on how I should go about creating this blog, I stubbled upon <a href="https://pages.github.com/">GitHub Pages</a> which allows GitHub users to create static pages that are hosted from a special repository named <code>&lt;your_username&gt;.github.io</code>. This is great because it allows GitHub users to easily serve up new content with a simple <code>git push</code> command without having to find a hosting service.</p>
<p>The next step for me was then to figure out how to setup a process by which I could create new content and quickly integrate it with my existing blog.</p>
<h3><b>Enter the static site generator.</b></h3><p>Static site generators leverage the templating capability of a dynamic site's server in order to produce a set of static resources that have uniformity of stylization without requiring you to copy and paste the same navigation bar, side bar, footer, etc. over and over again. There are a multitude of options when it comes to selecting a static site generator. Built with Ruby, <a href="https://jekyllrb.com/">Jekyll</a> is one of the most popular and is the recommended generator for GitHub Pages by GitHub itself. Another I had considered was <a href="https://blog.getpelican.com/">Pelican</a> which is built with Python. After an initial survey of my options, I decided that none of them fit my needs which were to have a simple yet customizable generator that was not opinionated about the layout of the blog.</p>
<p>It was at this point when I realized that I should just use Flask to render Jinja templates with HTML created by converting Jupyter notebooks containing my blog content. I knew immediately that this was the best way for me but wasn't quite sure how to go about it best. Thankfully, Nicolas Perriault has an <a href="https://nicolas.perriault.net/code/2012/dead-easy-yet-powerful-static-website-generator-with-flask/">excellent blog post</a> on how to easily achieve exactly what I want.</p>
<p>Here I'll summarize the key points in his blog post and detail the adaptations I made to adhere to my needs.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="My-GitHub-Pages-User-Page">My GitHub Pages User Page<a class="anchor-link" href="#My-GitHub-Pages-User-Page">&#182;</a></h2><p>First of all, I'll provide a link to my <a href="https://github.com/a-rich/a-rich.github.io">repository</a> which houses this blog. We'll be focusing on <a href="https://github.com/a-rich/a-rich.github.io/blob/master/convert.py">convert.py</a> for turning Jupyter notebooks into blog post content and <a href="https://github.com/a-rich/a-rich.github.io/blob/master/sitebuilder.py">sitebuilder.py</a> for the creation of the static resources.</p>
<p>The process for creating a new blog post is started by filling out a Jupyter notebook before converting that into HTML and using BeautifulSoup to clean it up and insert Bootstrap css. The resulting HTML document is stored in a particular directory which <a href="https://pythonhosted.org/Flask-FlatPages/https://pythonhosted.org/Flask-FlatPages/"><code>Flask-FlatPages</code></a> references to load it. The Flask application in <code>sitebuilder.py</code> has an index route used to generate a link for every blog post, about page, and topic page captured by FlatPages. The application also has a page route that's hit by every link generated by the index route. The page route renders one of three templates depending on the <code>path</code> URL parameter. The final step is to take a snapshot of the page/link graph that is the blog site using <a href="https://pythonhosted.org/Frozen-Flask/"><code>Frozen-Flask</code></a>. All of this combined enables a one command pipeline from Jupyter notebook to updated blog site.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Step-by-Step">Step-by-Step<a class="anchor-link" href="#Step-by-Step">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Convert-Jupyter-notebook-to-HTML">Convert Jupyter notebook to HTML<a class="anchor-link" href="#Convert-Jupyter-notebook-to-HTML">&#182;</a></h3><p>Jupyter has a convenient CLI command for converting a notebook into HTML. The <code>--to</code> flag allows us to specify the output file format while the <code>--template</code> flag allows us to specify whether we want a basic or full output file (if you're using something like <a href="https://github.com/dunovank/jupyter-themes">jupyterthemes</a> and you want capture these themes for your blog, use the full template).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">jupyter</span><span class="o">-</span><span class="n">nbconvert</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">notebook</span><span class="o">.</span><span class="n">ipynb</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">to</span> <span class="n">html</span> <span class="o">--</span><span class="n">template</span> <span class="n">basic</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We include this at the beginning of the <code>convert.py</code> script as a subprocess call.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s1">&#39;jupyter-nbconvert&#39;</span><span class="p">,</span> <span class="n">infile</span><span class="p">,</span> <span class="s1">&#39;--to&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="s1">&#39;--template&#39;</span><span class="p">,</span> <span class="s1">&#39;basic&#39;</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Clean-up-notebook-HTML-using-BeautifulSoup">Clean up notebook HTML using BeautifulSoup<a class="anchor-link" href="#Clean-up-notebook-HTML-using-BeautifulSoup">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">),</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>

<span class="c1"># Remove weird characters at end of markdown cells</span>
<span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;anchor-link&#39;</span><span class="p">})]</span>

<span class="c1"># Remove prompt brackets before all executable cells</span>
<span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;prompt input_prompt&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;input&#39;</span><span class="p">})]</span>

<span class="c1"># Remove prompt brackets before all outputs</span>
<span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;prompt output_prompt&#39;</span><span class="p">})]</span>

<span class="c1"># Remove extra matplotlib.legend output line</span>
<span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;output_text&#39;</span><span class="p">})</span>
        <span class="k">if</span> <span class="s1">&#39;matplotlib&#39;</span> <span class="ow">in</span> <span class="n">o</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;pre&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_text</span><span class="p">()]</span>

<span class="c1"># Add card css class, padding/margins, color to all code</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;input_area&#39;</span><span class="p">}):</span>
    <span class="n">c</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;card&#39;</span><span class="p">,</span> <span class="s1">&#39;px-2&#39;</span><span class="p">,</span> <span class="s1">&#39;pt-2&#39;</span><span class="p">,</span> <span class="s1">&#39;my-3&#39;</span><span class="p">]</span>
    <span class="n">c</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;background-color:#F7F7F9;&#39;</span><span class="p">]</span>

<span class="c1"># Add card css class, padding/margins, color to all markdown</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;inner_cell&#39;</span><span class="p">})</span>
        <span class="k">if</span> <span class="s1">&#39;input&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">parent</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]]:</span>
    <span class="n">m</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;bg-info&#39;</span><span class="p">,</span> <span class="s1">&#39;card&#39;</span><span class="p">,</span> <span class="s1">&#39;px-2&#39;</span><span class="p">,</span> <span class="s1">&#39;pt-2&#39;</span><span class="p">,</span> <span class="s1">&#39;my-3&#39;</span><span class="p">]</span>

<span class="c1"># Add card css class, padding/margins, color to all outputs</span>
<span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;output&#39;</span><span class="p">}):</span>
    <span class="n">o</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;card&#39;</span><span class="p">,</span> <span class="s1">&#39;px-2&#39;</span><span class="p">,</span> <span class="s1">&#39;pt-2&#39;</span><span class="p">,</span> <span class="s1">&#39;my-3&#39;</span><span class="p">]</span>

<span class="c1"># Change all &quot;small&quot; headers to the smallest</span>
<span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;h</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">size</span><span class="p">)):</span>
        <span class="n">h</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;h6&#39;</span>

<span class="c1"># Change all &quot;big&quot; headers to smaller headers</span>
<span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;h</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">size</span><span class="p">)):</span>
        <span class="n">h</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;font-weight-bold&#39;</span><span class="p">]</span>
        <span class="n">h</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;h</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The last part of <code>convert.py</code> prepends some optional YAML meta data to the notebook HTML and adds a <code>(title, date, path)</code> tuple to a manifest file that's used to update the recent blogs section in the side bar of the blog.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Use-Flask-FlatPages-to-aggregate-static-resources-and-render-a-list-of-links-to-them">Use Flask-FlatPages to aggregate static resources and render a list of links to them<a class="anchor-link" href="#Use-Flask-FlatPages-to-aggregate-static-resources-and-render-a-list-of-links-to-them">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Imports,-app-configuration,-index-route">Imports, app configuration, index route<a class="anchor-link" href="#Imports,-app-configuration,-index-route">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">dateutil</span> <span class="k">import</span> <span class="n">parser</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">render_template</span>
<span class="kn">from</span> <span class="nn">flask_flatpages</span> <span class="k">import</span> <span class="n">FlatPages</span>
<span class="kn">from</span> <span class="nn">flask_frozen</span> <span class="k">import</span> <span class="n">Freezer</span>

<span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">FLATPAGES_AUTO_RELOAD</span> <span class="o">=</span> <span class="n">DEBUG</span>
<span class="n">FLATPAGES_EXTENSION</span> <span class="o">=</span> <span class="s1">&#39;.html&#39;</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">pages</span> <span class="o">=</span> <span class="n">FlatPages</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">freezer</span> <span class="o">=</span> <span class="n">Freezer</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="n">pages</span><span class="o">=</span><span class="n">pages</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="index.html">index.html<a class="anchor-link" href="#index.html">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
    {% for page in pages %}
        <li>
            <a href="{{ url_for("page", path=page.path) }}">{{ page.title }}</a>
        </li>
    {% else %}
        <li>No posts.</li>
    {% endfor %}
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Page-route">Page route<a class="anchor-link" href="#Page-route">&#182;</a></h3><p>Each link rendered in the index.html template points to the other route of the application which, depending on the path of the FlatPage, will render one of three templates. There is an about.html template that renders the blog's landing page, a content.html template that renders all blog post pages including this one, and a blog_posts.html template which renders the list of all blog posts as well as all the lists of blog posts by individual topic.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;blog.manifest&#39;</span><span class="p">):</span>
    <span class="n">manifest</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;blog.manifest&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">manifest</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">recent_posts</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">manifest</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>

<span class="n">groups</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)]):</span>
              <span class="nb">sorted</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pages</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>
          <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pages</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;site&#39;</span><span class="p">]))</span>
    <span class="p">}</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="p">{</span>
    <span class="s1">&#39;about&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;about.html&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
    <span class="s1">&#39;all&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;blog_posts.html&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span> <span class="s1">&#39;Blog Posts&#39;</span><span class="p">],</span>
    <span class="s1">&#39;data-visualization&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;blog_posts.html&#39;</span><span class="p">,</span> <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;Data Visualization&#39;</span><span class="p">],</span> <span class="s1">&#39;Data Visualization&#39;</span><span class="p">],</span>
    <span class="s1">&#39;in-a-nutshell&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;blog_posts.html&#39;</span><span class="p">,</span> <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;In A Nutshell&#39;</span><span class="p">],</span> <span class="s1">&#39;In A Nutshell&#39;</span><span class="p">],</span>
    <span class="s1">&#39;machine-learning&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;blog_posts.html&#39;</span><span class="p">,</span> <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;Machine Learning&#39;</span><span class="p">],</span> <span class="s1">&#39;Machine Learning&#39;</span><span class="p">],</span>
    <span class="s1">&#39;python&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;blog_posts.html&#39;</span><span class="p">,</span> <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;Python&#39;</span><span class="p">],</span> <span class="s1">&#39;Python&#39;</span><span class="p">],</span>
    <span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pages</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">header</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">posts</span><span class="o">=</span><span class="n">recent_posts</span><span class="p">)</span>

    <span class="n">page</span> <span class="o">=</span> <span class="n">pages</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">html</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;content.html&#39;</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">posts</span><span class="o">=</span><span class="n">recent_posts</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Freezing-the-app-and-cleaning-up-the-directory">Freezing the app and cleaning up the directory<a class="anchor-link" href="#Freezing-the-app-and-cleaning-up-the-directory">&#182;</a></h2><p>When Frozen-Flask freezes the app, all of the index.html links will be traversed hitting the page route creating a fully rendered HTML page for the each blog and the fixed pages (about and topics). These static files are placed into a directory called <code>build</code> by Frozen-Flask. The final part of <code>sitebuilder.py</code> builds the static resources before moving and removing files to order the directory.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;build&#39;</span><span class="p">:</span>
        <span class="n">freezer</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;pages&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;build/index.html&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;build/static&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;build/site/about/index.html&#39;</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;build/site/about&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;build/&#39;</span><span class="o">+</span><span class="n">directory</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Final-steps">Final steps<a class="anchor-link" href="#Final-steps">&#182;</a></h2><p>We can add an additional subprocess call to the end of <code>convert.py</code> that runs the Flask application.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s1">&#39;python3&#39;</span><span class="p">,</span> <span class="s1">&#39;sitebuilder.py&#39;</span><span class="p">,</span> <span class="s1">&#39;build&#39;</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This way we can run one command to convert a Jupyter notebook into an HTML document and update the static files for the blog. Then we simply push the changes to the GitHub Pages User Page and we're done!</p>

</div>
</div>
</div>
 

